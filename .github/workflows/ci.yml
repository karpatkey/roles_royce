name: Roles Royce tests

on: [push]

env:
  GIT_REF: ${{ github.head_ref || github.ref_name }}
  DOCKER_REGISTRY: ${{ secrets.DOCKER_URL }}
  DOCKER_USERNAME: ${{ secrets.DOCKER_USERNAME }}
  DOCKER_PASSWORD: ${{ secrets.DOCKER_PASSWORD }}

jobs:
  github-latency:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    steps:
      - name: Knode latency
        run: |
          sudo apt-get update -qq && sudo apt-get install -qq -y curl
          curl -w "\ndnslookup: %{time_namelookup} | connect: %{time_connect} | appconnect: %{time_appconnect} | pretransfer: %{time_pretransfer} | redirect: %{time_redirect} | starttransfer: %{time_starttransfer} | total: %{time_total} | size: %{size_download}\n" -so /dev/null  https://knode.karpatkey.com/status

  Selfhosted-latency:
    runs-on: self-hosted
    steps:

      - name: Knode latency
        run: |
          sudo apt-get update -qq && sudo apt-get install -qq -y curl
          curl -w "\ndnslookup: %{time_namelookup} | connect: %{time_connect} | appconnect: %{time_appconnect} | pretransfer: %{time_pretransfer} | redirect: %{time_redirect} | starttransfer: %{time_starttransfer} | total: %{time_total} | size: %{size_download}\n" -so /dev/null  https://knode.karpatkey.com/status
