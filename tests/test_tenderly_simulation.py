from roles_royce import roles
from roles_royce.protocols.eth import aura
from roles_royce.toolshed.simulation import (
    TenderlyCredentials,
    simulate_tx,
    tenderly_share_simulation,
    tenderly_simulate,
)

from .utils import local_node_eth

API_URL = "https://api.tenderly.co/api/v1/"

RESP_TEXT = '{"transaction":{"hash":"0x984417c28b9dbd643f2f0a7a00d312881a27ba0982ce934e1dcb4a7521aa7243","block_hash":"","block_number":17994590,"from":"0xf099e0f6604bde0aa860b39f7da75770b34ac804","gas":119704,"gas_price":0,"gas_fee_cap":0,"gas_tip_cap":0,"cumulative_gas_used":0,"gas_used":84604,"effective_gas_price":0,"input":"0x6928e74b00000000000000000000000032296969ef14eb0c6d29669c550d4a0449130230000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000044095ea7b3000000000000000000000000a57b8d98dae62b26ec3bcc4a365338157060b23400000000000000000000000000000000000000000000000000000000000003e800000000000000000000000000000000000000000000000000000000","nonce":1,"to":"0x1cfb0cd7b1111bf2054615c7c491a15c4a3303cc","index":0,"value":"0x","access_list":null,"status":true,"addresses":null,"contract_ids":null,"network_id":"1","timestamp":"2023-08-25T22:09:11Z","function_selector":"","l1_block_number":0,"l1_timestamp":0,"deposit_tx":false,"system_tx":false,"sig":{"v":"0x0","r":"0x0","s":"0x0"},"transaction_info":{"contract_id":"eth:1:0x1cfb0cd7b1111bf2054615c7c491a15c4a3303cc","block_number":17994590,"transaction_id":"0x984417c28b9dbd643f2f0a7a00d312881a27ba0982ce934e1dcb4a7521aa7243","contract_address":"0x1cfb0cd7b1111bf2054615c7c491a15c4a3303cc","method":null,"parameters":null,"intrinsic_gas":22944,"refund_gas":0,"call_trace":{"hash":"0x984417c28b9dbd643f2f0a7a00d312881a27ba0982ce934e1dcb4a7521aa7243","contract_name":"","function_pc":0,"function_op":"CALL","absolute_position":0,"caller_pc":0,"caller_op":"CALL","call_type":"CALL","from":"0xf099e0f6604bde0aa860b39f7da75770b34ac804","from_balance":"0","to":"0x1cfb0cd7b1111bf2054615c7c491a15c4a3303cc","to_balance":"0","value":"0","block_timestamp":"0001-01-01T00:00:00Z","gas":96760,"gas_used":61660,"intrinsic_gas":22944,"event_references":null,"input":"0x6928e74b00000000000000000000000032296969ef14eb0c6d29669c550d4a0449130230000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000044095ea7b3000000000000000000000000a57b8d98dae62b26ec3bcc4a365338157060b23400000000000000000000000000000000000000000000000000000000000003e800000000000000000000000000000000000000000000000000000000","nonce_diff":[{"address":"0xf099e0f6604BDE0AA860B39F7da75770B34aC804","original":"1","dirty":"2"}],"state_diff":[{"address":"0x32296969ef14eb0c6d29669c550d4a0449130230","soltype":null,"original":null,"dirty":null,"raw":[{"address":"0x32296969ef14eb0c6d29669c550d4a0449130230","key":"0xe2067790612279ead1ef7c47f1d186c1ba437fcd459c51c30045fe3d523ea2c8","original":"0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff","dirty":"0x00000000000000000000000000000000000000000000000000000000000003e8"}]}],"logs":[{"name":"","anonymous":false,"inputs":null,"raw":{"address":"0x32296969ef14eb0c6d29669c550d4a0449130230","topics":["0x8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925","0x000000000000000000000000849d52316331967b6ff1198e5e32a0eb168d039d","0x000000000000000000000000a57b8d98dae62b26ec3bcc4a365338157060b234"],"data":"0x00000000000000000000000000000000000000000000000000000000000003e8"},"trace_index":null},{"name":"","anonymous":false,"inputs":null,"raw":{"address":"0x849d52316331967b6ff1198e5e32a0eb168d039d","topics":["0x6895c13664aa4f67288b25d7a21d7aaa34916e355fb9b6fae0a139a9085becb8","0x0000000000000000000000001cfb0cd7b1111bf2054615c7c491a15c4a3303cc"],"data":"0x"},"trace_index":null}],"output":"0x0000000000000000000000000000000000000000000000000000000000000001","decoded_output":null,"network_id":"1","calls":[{"hash":"","function_pc":0,"function_op":"STOP","absolute_position":5050,"caller_pc":31,"caller_op":"DELEGATECALL","call_type":"DELEGATECALL","from":"0x1cfb0cd7b1111bf2054615c7c491a15c4a3303cc","from_balance":"0","to":"0xd8dfc1d938d7d163c5231688341e9635e9011889","to_balance":"0","value":null,"caller":{"address":"0xf099e0f6604bde0aa860b39f7da75770b34ac804","balance":"0"},"block_timestamp":"0001-01-01T00:00:00Z","gas":92601,"gas_used":58934,"refund_gas":1469,"event_references":null,"input":"0x6928e74b00000000000000000000000032296969ef14eb0c6d29669c550d4a0449130230000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000044095ea7b3000000000000000000000000a57b8d98dae62b26ec3bcc4a365338157060b23400000000000000000000000000000000000000000000000000000000000003e800000000000000000000000000000000000000000000000000000000","output":"0x0000000000000000000000000000000000000000000000000000000000000001","decoded_output":null,"network_id":"","calls":[{"hash":"","function_pc":0,"function_op":"STOP","absolute_position":3721,"caller_pc":7322,"caller_op":"DELEGATECALL","call_type":"DELEGATECALL","from":"0xd8dfc1d938d7d163c5231688341e9635e9011889","from_balance":"0","to":"0x33d1c5a5b6a7f3885c7467e829aaa21698937597","to_balance":"0","value":null,"caller":{"address":"0xf099e0f6604bde0aa860b39f7da75770b34ac804","balance":"0"},"block_timestamp":"0001-01-01T00:00:00Z","gas":81574,"gas_used":20400,"refund_gas":1294,"event_references":null,"input":"0xdb50e575a775687211c2b3346a0f5a2a0e7590e6c1838453e3785e6dd2a8efd6265ddf15000000000000000000000000a238cbeb142c10ef7ad8442c6d1f9e89e07e776100000000000000000000000032296969ef14eb0c6d29669c550d4a0449130230000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000044095ea7b3000000000000000000000000a57b8d98dae62b26ec3bcc4a365338157060b23400000000000000000000000000000000000000000000000000000000000003e800000000000000000000000000000000000000000000000000000000","output":"0x","decoded_output":null,"network_id":"","calls":null},{"hash":"","function_pc":0,"function_op":"STOP","absolute_position":4835,"caller_pc":12736,"caller_op":"CALL","call_type":"CALL","from":"0xd8dfc1d938d7d163c5231688341e9635e9011889","from_balance":"0","to":"0x849d52316331967b6ff1198e5e32a0eb168d039d","to_balance":"53786536651200345896","value":"0","block_timestamp":"0001-01-01T00:00:00Z","gas":53157,"gas_used":19544,"refund_gas":843,"event_references":null,"input":"0x468721a700000000000000000000000032296969ef14eb0c6d29669c550d4a04491302300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000044095ea7b3000000000000000000000000a57b8d98dae62b26ec3bcc4a365338157060b23400000000000000000000000000000000000000000000000000000000000003e800000000000000000000000000000000000000000000000000000000","output":"0x0000000000000000000000000000000000000000000000000000000000000001","decoded_output":null,"network_id":"","calls":[{"hash":"","function_pc":0,"function_op":"STOP","absolute_position":4821,"caller_pc":94,"caller_op":"DELEGATECALL","call_type":"DELEGATECALL","from":"0x849d52316331967b6ff1198e5e32a0eb168d039d","from_balance":"53786536651200345896","to":"0xd9db270c1b5e3bd161e8c8503c55ceabee709552","to_balance":"33000000000000020","value":null,"caller":{"address":"0x1cfb0cd7b1111bf2054615c7c491a15c4a3303cc","balance":"0"},"block_timestamp":"0001-01-01T00:00:00Z","gas":47574,"gas_used":14671,"refund_gas":755,"event_references":{"NumberOfEvents":1,"event_indices":null},"input":"0x468721a700000000000000000000000032296969ef14eb0c6d29669c550d4a04491302300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000044095ea7b3000000000000000000000000a57b8d98dae62b26ec3bcc4a365338157060b23400000000000000000000000000000000000000000000000000000000000003e800000000000000000000000000000000000000000000000000000000","output":"0x0000000000000000000000000000000000000000000000000000000000000001","decoded_output":null,"network_id":"","calls":[{"hash":"","function_pc":0,"function_op":"STOP","absolute_position":4759,"caller_pc":20173,"caller_op":"CALL","call_type":"CALL","from":"0xd9db270c1b5e3bd161e8c8503c55ceabee709552","from_balance":"33000000000000020","to":"0x32296969ef14eb0c6d29669c550d4a0449130230","to_balance":"0","value":"0","block_timestamp":"0001-01-01T00:00:00Z","gas":41128,"gas_used":7572,"refund_gas":652,"event_references":{"NumberOfEvents":1,"event_indices":null},"input":"0x095ea7b3000000000000000000000000a57b8d98dae62b26ec3bcc4a365338157060b23400000000000000000000000000000000000000000000000000000000000003e8","output":"0x0000000000000000000000000000000000000000000000000000000000000001","decoded_output":null,"network_id":"","calls":null}]}]}]}]},"stack_trace":null,"logs":[{"name":"","anonymous":false,"inputs":null,"raw":{"address":"0x32296969ef14eb0c6d29669c550d4a0449130230","topics":["0x8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925","0x000000000000000000000000849d52316331967b6ff1198e5e32a0eb168d039d","0x000000000000000000000000a57b8d98dae62b26ec3bcc4a365338157060b234"],"data":"0x00000000000000000000000000000000000000000000000000000000000003e8"},"trace_index":null},{"name":"","anonymous":false,"inputs":null,"raw":{"address":"0x849d52316331967b6ff1198e5e32a0eb168d039d","topics":["0x6895c13664aa4f67288b25d7a21d7aaa34916e355fb9b6fae0a139a9085becb8","0x0000000000000000000000001cfb0cd7b1111bf2054615c7c491a15c4a3303cc"],"data":"0x"},"trace_index":null}],"balance_diff":null,"nonce_diff":[{"address":"0xf099e0f6604BDE0AA860B39F7da75770B34aC804","original":"1","dirty":"2"}],"state_diff":[{"address":"0x32296969ef14eb0c6d29669c550d4a0449130230","soltype":null,"original":null,"dirty":null,"raw":[{"address":"0x32296969ef14eb0c6d29669c550d4a0449130230","key":"0xe2067790612279ead1ef7c47f1d186c1ba437fcd459c51c30045fe3d523ea2c8","original":"0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff","dirty":"0x00000000000000000000000000000000000000000000000000000000000003e8"}]}],"raw_state_diff":null,"console_logs":null,"asset_changes":null,"balance_changes":[],"created_at":"2023-08-25T22:09:11Z"},"method":"","decoded_input":null,"call_trace":[{"call_type":"CALL","from":"0xf099e0f6604bde0aa860b39f7da75770b34ac804","to":"0x1cfb0cd7b1111bf2054615c7c491a15c4a3303cc","gas":96760,"gas_used":61660,"subtraces":1,"type":"CALL","input":"0x6928e74b00000000000000000000000032296969ef14eb0c6d29669c550d4a0449130230000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000044095ea7b3000000000000000000000000a57b8d98dae62b26ec3bcc4a365338157060b23400000000000000000000000000000000000000000000000000000000000003e800000000000000000000000000000000000000000000000000000000","output":"0x0000000000000000000000000000000000000000000000000000000000000001"},{"call_type":"DELEGATECALL","from":"0x1cfb0cd7b1111bf2054615c7c491a15c4a3303cc","to":"0xd8dfc1d938d7d163c5231688341e9635e9011889","gas":92601,"gas_used":58934,"subtraces":2,"trace_address":[0],"type":"CALL","input":"0x6928e74b00000000000000000000000032296969ef14eb0c6d29669c550d4a0449130230000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000044095ea7b3000000000000000000000000a57b8d98dae62b26ec3bcc4a365338157060b23400000000000000000000000000000000000000000000000000000000000003e800000000000000000000000000000000000000000000000000000000","output":"0x0000000000000000000000000000000000000000000000000000000000000001","gas_in":96670,"gas_cost":95201},{"call_type":"DELEGATECALL","from":"0x1cfb0cd7b1111bf2054615c7c491a15c4a3303cc","to":"0x33d1c5a5b6a7f3885c7467e829aaa21698937597","gas":81574,"gas_used":20400,"trace_address":[0,0],"type":"CALL","input":"0xdb50e575a775687211c2b3346a0f5a2a0e7590e6c1838453e3785e6dd2a8efd6265ddf15000000000000000000000000a238cbeb142c10ef7ad8442c6d1f9e89e07e776100000000000000000000000032296969ef14eb0c6d29669c550d4a0449130230000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000044095ea7b3000000000000000000000000a57b8d98dae62b26ec3bcc4a365338157060b23400000000000000000000000000000000000000000000000000000000000003e800000000000000000000000000000000000000000000000000000000","outOff":128,"gas_in":82968,"gas_cost":81674},{"call_type":"CALL","from":"0x1cfb0cd7b1111bf2054615c7c491a15c4a3303cc","to":"0x849d52316331967b6ff1198e5e32a0eb168d039d","gas":53157,"gas_used":19544,"subtraces":1,"trace_address":[0,1],"type":"CALL","input":"0x468721a700000000000000000000000032296969ef14eb0c6d29669c550d4a04491302300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000044095ea7b3000000000000000000000000a57b8d98dae62b26ec3bcc4a365338157060b23400000000000000000000000000000000000000000000000000000000000003e800000000000000000000000000000000000000000000000000000000","output":"0x0000000000000000000000000000000000000000000000000000000000000001","outOff":256,"outLen":32,"gas_in":54100,"gas_cost":53257,"toBalance":"0x02ea702a1c69533728"},{"call_type":"DELEGATECALL","from":"0x849d52316331967b6ff1198e5e32a0eb168d039d","to":"0xd9db270c1b5e3bd161e8c8503c55ceabee709552","gas":47574,"gas_used":14671,"subtraces":1,"trace_address":[0,1,0],"type":"CALL","input":"0x468721a700000000000000000000000032296969ef14eb0c6d29669c550d4a04491302300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000044095ea7b3000000000000000000000000a57b8d98dae62b26ec3bcc4a365338157060b23400000000000000000000000000000000000000000000000000000000000003e800000000000000000000000000000000000000000000000000000000","output":"0x0000000000000000000000000000000000000000000000000000000000000001","gas_in":50929,"gas_cost":50174,"fromBalance":"0x02ea702a1c69533728","toBalance":"0x753d533d968014"},{"call_type":"CALL","from":"0x849d52316331967b6ff1198e5e32a0eb168d039d","to":"0x32296969ef14eb0c6d29669c550d4a0449130230","gas":41128,"gas_used":7572,"trace_address":[0,1,0,0],"type":"CALL","input":"0x095ea7b3000000000000000000000000a57b8d98dae62b26ec3bcc4a365338157060b23400000000000000000000000000000000000000000000000000000000000003e8","output":"0x0000000000000000000000000000000000000000000000000000000000000001","gas_in":44380,"gas_cost":43728,"fromBalance":"0x02ea702a1c69533728"}]},"simulation":{"id":"5a54ccd3-1b3b-4f4a-a0c7-351f8d16f81b","project_id":"712c7af3-f9ec-4568-ada1-0700826896f5","owner_id":"foobarbaz-d123-4140-adfb-123978bc0ab9","network_id":"1","block_number":17994590,"transaction_index":0,"from":"0xf099e0f6604BDE0AA860B39F7da75770B34aC804","to":"0x1cFB0CD7B1111bf2054615C7C491a15C4A3303cc","input":"0x6928e74b00000000000000000000000032296969ef14eb0c6d29669c550d4a0449130230000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000044095ea7b3000000000000000000000000a57b8d98dae62b26ec3bcc4a365338157060b23400000000000000000000000000000000000000000000000000000000000003e800000000000000000000000000000000000000000000000000000000","gas":119704,"gas_price":"0","gas_used":84604,"value":"0","status":true,"access_list":null,"queue_origin":"","block_header":{"number":"0x112935e","hash":"0x0000000000000000000000000000000000000000000000000000000000000000","stateRoot":"0xd7523a33ce52b298858a49c8d227e349d3f77112773a2ee3b08f10bec07e6116","parentHash":"0xbdd338edd91801c943ba73fa2dcdb98258e1c8a1bc41402b03e5ee856eb8e18f","sha3Uncles":"0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347","transactionsRoot":"0xe3f131128312aafd3773d0a8248a464e5ef0a471c5ba30869be6ac3bb7317cb0","receiptsRoot":"0x73883cf79f91604eeec4916207d852837a8a56c4fdd804d2fcea89803bcad487","logsBloom":"0x78a9c1064dd05953d11e313090903b2301a388912e0d4c3c70a722501a127100c0bab3cad4100b29199218205102a1842b8583198a253cbe17262104203bb2836343aad965db493cfb4a4aaef1442029ac50209004ca5b4200b52f65ad201c2092c049401307d56e078c91b01432cd570294c86060829409c0488014c94884f52762335f272988fc00d2e008032c9c232cb02d41cd10e8fed4a50e4e589ba0e8ab4d51a3a1236c798ae741f45db326b21414644a50a4a5234c4584241c5c0040c3d018d21f1009034a1c0428044c5a8e410e4792528e20946597900688d8a98a38b7a08e0d06c2fbc3ad3083a9456000403756603b1e82d50041b92774eab7ee","timestamp":"0x64e92687","difficulty":"0x0","gasLimit":"0x1c9c380","gasUsed":"0xc2d0f2","miner":"0x4838b106fce9647bdf1e7877bf73ce8b0bad5f97","extraData":"0x546974616e2028746974616e6275696c6465722e78797a29","mixHash":"0x212840408784e15a39337c2e750cfad98cfaeccb7e1ee130768a84754215c6e3","nonce":"0x0000000000000000","baseFeePerGas":"0x341d144aa","size":"0x0","totalDifficulty":"0x0","uncles":null,"transactions":null},"deposit_tx":false,"system_tx":false,"nonce":1,"addresses":null,"contract_ids":null,"shared":false,"created_at":"2023-08-25T22:24:56.316566462Z"},"contracts":[],"generated_access_list":[]}'

tenderly_credentials = TenderlyCredentials(
    account_id="foobarbaz-d123-4140-adfb-123978bc0ab9", project="project", api_token="MyAPiToken123123123"
)


def test_tenderly_simulate(local_node_eth, requests_mock):
    w3 = local_node_eth.w3
    requests_mock.real_http = True

    ROLES_MOD = "0x1cFB0CD7B1111bf2054615C7C491a15C4A3303cc"
    REVOKER_ROLE = "0xf099e0f6604BDE0AA860B39F7da75770B34aC804"
    LP80GNO20WETH = "0x32296969Ef14EB0c6d29669C550D4a0449130230"

    method = aura.ApproveForBooster(token=LP80GNO20WETH, amount=1000)

    tx = roles.build(txs=[method], role=1, account=REVOKER_ROLE, roles_mod_address=ROLES_MOD, web3=w3)

    requests_mock.post(
        f"https://api.tenderly.co/api/v1/account/foobarbaz-d123-4140-adfb-123978bc0ab9/project/project/simulate",
        text=RESP_TEXT,
    )

    sim_data = tenderly_simulate(
        tenderly_credentials=tenderly_credentials,
        from_addr=tx["from"],
        to_addr=tx["to"],
        value=tx["value"],
        network_id=str(tx["chainId"]),
        gas=tx["gas"],
        calldata=tx["data"],
        block_number=17994590,
        sim_type="quick",
    )
    assert sim_data["simulation"]["block_number"] == 17994590
    assert sim_data["transaction"]["status"]
    assert sim_data["transaction"]["call_trace"][0] == {
        "call_type": "CALL",
        "from": "0xf099e0f6604bde0aa860b39f7da75770b34ac804",
        "to": "0x1cfb0cd7b1111bf2054615c7c491a15c4a3303cc",
        "gas": 96760,
        "gas_used": 61660,
        "subtraces": 1,
        "type": "CALL",
        "input": "0x6928e74b00000000000000000000000032296969ef14eb0c6d29669c550d4a0449130230000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000044095ea7b3000000000000000000000000a57b8d98dae62b26ec3bcc4a365338157060b23400000000000000000000000000000000000000000000000000000000000003e800000000000000000000000000000000000000000000000000000000",
        "output": "0x0000000000000000000000000000000000000000000000000000000000000001",
    }

    # using the helper function instead of the low level one
    sim_data2 = simulate_tx(tx, block=17994590, tenderly_credentials=tenderly_credentials, sim_type="quick")
    assert sim_data == sim_data2


def test_share_simulation(requests_mock):
    requests_mock.post(
        f"/api/v1/account/foobarbaz-d123-4140-adfb-123978bc0ab9/project/project/simulations/8a37d0fe-570d-40db-9f42-aa59c7aeb463/share",
        text="",
    )

    url = tenderly_share_simulation(
        tenderly_credentials=tenderly_credentials, simulation_id="8a37d0fe-570d-40db-9f42-aa59c7aeb463"
    )

    assert url == "https://dashboard.tenderly.co/shared/simulation/8a37d0fe-570d-40db-9f42-aa59c7aeb463"
